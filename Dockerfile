FROM node:16

WORKDIR /deimos

COPY package.json yarn.lock ./
RUN yarn

COPY . .

ARG TYPEORM_CONNECTION
ARG TYPEORM_URL
ARG TYPEORM_ENTITIES
ARG TYPEORM_SEEDING_FACTORIES
ARG TYPEORM_SEEDING_SEEDS
ARG TYPEORM_SYNCHRONIZE
ARG USER_ADMIN_EMAIL
ARG USER_CLIENT_EMAIL
ARG USER_PASS

RUN yarn build
RUN yarn seed

EXPOSE 3010

CMD [ "node", "dist/main.js" ]
